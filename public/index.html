<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Find neighbor photos</title>
  <style>
    :root{color-scheme:dark}
    body{margin:0;background:#0b1220;color:#e6eefc;font:16px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    h1{margin:0 0 16px;font-size:28px}
    .bar{display:flex;gap:10px}
    input{flex:1;min-width:260px;padding:10px 12px;border-radius:10px;border:1px solid #233046;background:#0b1220;color:#e6eefc}
    button{padding:10px 14px;border:0;border-radius:10px;background:#22c55e;color:#0b1220;font-weight:700;cursor:pointer}
    #msg{margin:10px 0 0;color:#9aa4b2;min-height:1.2em}
    .row{display:flex;flex-wrap:wrap;gap:14px;margin-top:16px}
    .tile{width:320px;border:1px solid #233046;border-radius:12px;overflow:hidden;background:#0f172a}
    .lbl{padding:6px 8px;font-size:12px;color:#9aa4b2}
    .img{display:block;width:100%;height:auto;background:#0b1220}
    .cap{padding:6px 8px;font-size:12px;color:#9aa4b2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Find neighbor photos</h1>
    <div class="bar">
      <input id="url" placeholder="Paste full Cloudinary URL ending in .../CH0928251006.jpg" />
      <button id="go">Load</button>
    </div>
    <div id="msg"></div>
    <div id="row" class="row"></div>
  </div>

  <script>
    const row = document.getElementById('row');
    const msg = document.getElementById('msg');

    function buildNeighbors(fullUrl){
      try{
        const u = new URL(fullUrl.trim());
        if(!/res\.cloudinary\.com/i.test(u.hostname)) return null;

        const parts = u.pathname.split('/');     // keep entire folder path untouched
        let file = parts.pop();                  // CH0928251006.jpg
        const extMatch = file.match(/\.(jpe?g)$/i);
        if(!extMatch) return null;
        const ext = extMatch[0];                 // .jpg/.jpeg
        const nameNoExt = file.replace(/\.(jpe?g)$/i,'');

        const m = nameNoExt.match(/^(.*?)(\d+)$/);
        if(!m) return null;
        const prefix = m[1];
        const digits = m[2];
        const n = parseInt(digits,10);
        const pad = digits.length;

        const fname = nv => prefix + String(nv).padStart(pad,'0') + ext;
        const make = withFile => u.origin + parts.concat(withFile).join('/');

        return {
          prev: make(fname(n-1)),
          cur : make(fname(n)),
          next: make(fname(n+1)),
          labels: {
            prev:'Previous ('+(n-1)+')',
            cur :'This photo ('+n+')',
            next:'Next ('+(n+1)+')'
          }
        };
      }catch(e){ return null; }
    }

    function addTile(url,label){
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.innerHTML = `
        <div class="lbl">${label}</div>
        <img class="img" loading="eager" decoding="async" src="${url}">
        <div class="cap">${url.replace(/^https?:\/\/[^/]+\/image\/upload\//,'')}</div>`;
      tile.querySelector('img').addEventListener('error', () => tile.remove());
      row.appendChild(tile);
    }

    document.getElementById('go').onclick = () => {
      row.innerHTML = '';
      msg.textContent = 'Loadingâ€¦';
      const input = document.getElementById('url').value;
      const parsed = buildNeighbors(input);
      if(!parsed){ msg.textContent='Paste the full URL ending in .jpg or .jpeg.'; return; }
      msg.textContent = '';
      addTile(parsed.prev , parsed.labels.prev);
      addTile(parsed.cur  , parsed.labels.cur );
      addTile(parsed.next , parsed.labels.next);
    };
  </script>
</body>
</html>
