<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MyTouristPhoto Finder</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background-color: #0e1014;
      color: #fff;
      margin: 0;
      padding: 40px;
      text-align: center;
    }
    h1 {
      color: #7ef9a7;
      font-size: 32px;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }
    p {
      color: #aaa;
      font-size: 16px;
      line-height: 1.5;
    }
    input {
      padding: 10px 14px;
      width: 320px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #444;
      margin-top: 8px;
    }
    button {
      background-color: #5ef58b;
      border: none;
      border-radius: 8px;
      color: #000;
      font-weight: 600;
      padding: 10px 16px;
      margin-left: 6px;
      cursor: pointer;
    }
    button:hover { background-color: #81ffaa; }
    #msg {
      color: #aaa;
      margin-top: 10px;
      font-size: 15px;
    }
    #row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      margin-top: 20px;
    }
    .card {
      background: #1a1d23;
      border: 1px solid #333;
      border-radius: 10px;
      width: 280px;
      overflow: hidden;
    }
    .card img {
      width: 100%;
      height: auto;
      display: block;
    }
    .cap {
      padding: 6px;
      font-size: 13px;
      color: #ccc;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    footer {
      color: #888;
      font-size: 13px;
      margin-top: 40px;
    }
  </style>
</head>

<body>
  <h1>Find your photos</h1>
  <p>Enter your <strong>Photo ID</strong> (for example <code>CH0928251007</code>) and click Load.</p>
  <input id="photoId" placeholder="Photo ID" />
  <button id="goBtn">Load</button>
  <div id="msg"></div>
  <div id="row"></div>

  <footer>
    Having trouble? Contact us at <strong>info@mytouristphoto.com</strong><br>
    Â© 2025 MyTouristPhoto.com
  </footer>

  <script>
    const CLOUD = "dvqpndvej";
    const $ = s => document.querySelector(s);
    const msg = $("#msg");
    const row = $("#row");

    const deliveryUrl = id => `https://res.cloudinary.com/${CLOUD}/image/upload/${id}.jpg`;

    const headOK = url => fetch(url, { method: "HEAD" }).then(r => r.ok).catch(() => false);

    const addCard = (url, label) => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `<img src="${url}" alt=""><div class="cap">${label}</div>`;
      row.appendChild(card);
    };

    function plusMinusOne(id) {
      const digits = (id.match(/(\\d+)$/) || [])[1] || "";
      const prefix = id.slice(0, id.length - digits.length);
      const n = parseInt(digits || "0", 10);
      return [`${prefix}${n-1}`, id, `${prefix}${n+1}`];
    }

    async function findExistingPublicId(shortId) {
      const venues = ["chiefs-luau"];
      const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      const start = new Date();
      for (let d = 0; d < 90; d++) {
        const dt = new Date(start); dt.setDate(start.getDate() - d);
        const Y = dt.getFullYear();
        const Mtxt = months[dt.getMonth()];
        const mdY = ("0" + (dt.getMonth() + 1)).slice(-2) + "." + ("0" + dt.getDate()).slice(-2) + "." + Y;
        const withMonth = `${venues[0]}/${Y}/${Mtxt}/${mdY}/${shortId}`;
        if (await headOK(deliveryUrl(withMonth))) return withMonth;
      }
      return null;
    }

    $("#goBtn").onclick = async () => {
      row.innerHTML = "";
      msg.textContent = "";
      const raw = ($("#photoId").value || "").trim();
      if (!raw) { msg.textContent = "Please enter your Photo ID."; return; }

      msg.textContent = "Searching...";
      const publicId = await findExistingPublicId(raw);
      if (!publicId) { msg.textContent = "No image found."; return; }

      const folder = publicId.replace(/\\/[^/]+$/, "");
      const file = publicId.split("/").pop();
      const [prev, cur, next] = plusMinusOne(file);
      const candidates = [`${folder}/${prev}`, `${folder}/${cur}`, `${folder}/${next}`];

      const checks = await Promise.all(candidates.map(p => headOK(deliveryUrl(p)).then(ok => ({ ok, p }))));
      const found = checks.filter(c => c.ok);
      found.forEach(c => addCard(deliveryUrl(c.p), c.p));
      msg.textContent = found.length ? "Done." : "None found.";
    };
  </script>
</body>
</html>
