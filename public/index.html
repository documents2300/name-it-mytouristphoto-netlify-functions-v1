<script>
  // --- CONFIG: set these once ---
  const CLOUD = "dvqpndvej"; // your cloud name
  // Default folder when user types just CH... (no URL)
  // (Update this when your next event folder changes)
  const BASE_FOLDER = "chiefs-luau/2025/September/09.28.2025";

  // ---------- tiny helpers ----------
  const $ = s => document.querySelector(s);
  const row = $("#row") || (function(){ const d=document.createElement("div"); d.id="row"; d.style.display="grid"; d.style.gridTemplateColumns="repeat(auto-fit,minmax(280px,1fr))"; d.style.gap="12px"; document.body.appendChild(d); return d; })();
  const msg = $("#msg") || (function(){ const d=document.createElement("div"); d.id="msg"; d.style.margin="12px 0"; d.style.color="#9aa3ad"; document.body.insertBefore(d, row); return d; })();

  function imgExists(url){
    return new Promise(res=>{
      const i = new Image();
      i.onload = () => res({ok:true, url});
      i.onerror = () => res({ok:false, url});
      i.src = url;
    });
  }

  function addTile(url, label){
    const card = document.createElement("div");
    card.className = "card";
    card.style.border = "1px solid #2b2f36";
    card.style.borderRadius = "10px";
    card.style.overflow = "hidden";
    card.innerHTML = `
      <img src="${url}" style="display:block;width:100%;height:auto" />
      <div style="padding:8px 10px;font:14px system-ui,sans-serif;color:#b7c0c9">
        <div style="font-weight:600;margin-bottom:4px;color:#9dd6ff">${label}</div>
        <div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#8f98a3">${url.replace(/^https?:\/\/[^/]+\/image\/upload\//,'')}</div>
      </div>
    `;
    row.appendChild(card);
  }

  function parseInput(str){
    const raw = str.trim();
    if (!raw) return null;

    // Full Cloudinary URL?
    const m = raw.match(/^https?:\/\/res\.cloudinary\.com\/[^/]+\/image\/upload\/(.+?)\.(?:jpe?g|png|webp)$/i);
    if (m) {
      const full = m[1];                    // e.g. chiefs-luau/.../CH0928251006
      const folder = full.replace(/\/[^/]+$/, "");
      const file   = full.split("/").pop();
      return { folder, file };
    }

    // Otherwise assume it's a short CH... id
    return { folder: BASE_FOLDER, file: raw };
  }

  function neighbors(file){
    const digits = (file.match(/(\d+)$/) || [])[1] || "";
    const prefix = file.slice(0, file.length - digits.length);
    const n = parseInt(digits || "0", 10);
    return [
      { label: "Previous", file: `${prefix}${n-1}` },
      { label: "This photo", file: `${prefix}${n}` },
      { label: "Next",     file: `${prefix}${n+1}` },
    ];
  }

  function urlFor(folder, file){
    return `https://res.cloudinary.com/${CLOUD}/image/upload/${folder}/${file}.jpg`;
  }

  // Wire the button (keeps your existing input with id="urlInput" or "photoId")
  (document.getElementById("go") || document.getElementById("goBtn")).onclick = async () => {
    row.innerHTML = "";
    msg.textContent = "Loading...";
    const inputEl = document.getElementById("urlInput") || document.getElementById("photoId") || document.querySelector('input');
    const parsed = parseInput(inputEl.value || "");
    if (!parsed) { msg.textContent = "Please enter a Photo ID or Cloudinary URL."; return; }

    const picks = neighbors(parsed.file).map(p => ({ label: p.label, url: urlFor(parsed.folder, p.file) }));
    const checks = await Promise.all(picks.map(p => imgExists(p.url)));
    const found = checks.map((c,i)=>({ok:c.ok, url:c.url, label:picks[i].label})).filter(x=>x.ok);

    if (!found.length){
      msg.textContent = "None of those three images loaded. Double-check the folder and number.";
      return;
    }
    msg.textContent = "Done.";
    found.forEach(x => addTile(x.url, x.label));
  };
</script>
