<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find Neighbor Photos</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background-color: #0d1117;
      color: #e6edf3;
      margin: 0;
      padding: 40px;
      text-align: center;
    }
    h1 {
      color: #9dd6ff;
      margin-bottom: 20px;
    }
    input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #30363d;
      background: #161b22;
      color: #e6edf3;
      width: 70%;
      max-width: 600px;
    }
    button {
      padding: 10px 14px;
      border-radius: 8px;
      background: #238636;
      color: white;
      border: none;
      margin-left: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    #msg {
      margin-top: 15px;
      font-size: 14px;
      color: #9aa3ad;
    }
    #row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      margin-top: 30px;
    }
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 10px;
      width: 320px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .card img {
      display: block;
      width: 100%;
      height: auto;
    }
    .card .label {
      padding: 8px 10px;
      font-weight: 600;
      color: #9dd6ff;
      text-align: left;
    }
    .card .url {
      padding: 0 10px 10px;
      color: #8fa3b0;
      font-size: 13px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>Find Neighbor Photos</h1>
  <p>Paste a full Cloudinary URL (like below) and click Load.</p>
  <p><small>Example:  
  https://res.cloudinary.com/dvqpndvej/image/upload/chiefs-luau/2025/September/09.28.2025/CH0928251006.jpg</small></p>

  <input id="urlInput" placeholder="Paste Cloudinary URL ending in .jpg" />
  <button id="go">Load</button>
  <div id="msg"></div>
  <div id="row"></div>

  <script>
    const $ = s => document.querySelector(s);
    function imgOk(url){ return new Promise(r => {
      const i = new Image();
      i.onload = () => r({ok:true, url});
      i.onerror = () => r({ok:false, url});
      i.src = url;
    });}
    function addCard(url,label){
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${url}" alt="${label}" />
        <div class="label">${label}</div>
        <div class="url">${url.replace(/^https?:\/\/[^/]+\/image\/upload\//,'')}</div>
      `;
      $("#row").appendChild(card);
    }

    function parseInput(url){
      const m = url.match(/^https?:\/\/res\.cloudinary\.com\/[^/]+\/image\/upload\/(.+?)\/([^/]+)\.jpg$/i);
      if (!m) return null;
      return { folder: m[1], file: m[2] };
    }

    async function run(){
      const input = $("#urlInput");
      const msg = $("#msg");
      const row = $("#row");
      row.innerHTML = "";
      msg.textContent = "Loading...";

      const parsed = parseInput(input.value.trim());
      if (!parsed){ msg.textContent = "Please enter a full Cloudinary URL ending in .jpg"; return; }

      const m = parsed.file.match(/(\d+)$/);
      if (!m){ msg.textContent = "Could not find number at end of filename."; return; }

      const n = parseInt(m[1],10);
      const prefix = parsed.file.slice(0, parsed.file.length - m[1].length);

      const targets = [
        {label:"Previous", url:`https://res.cloudinary.com/dvqpndvej/image/upload/${parsed.folder}/${prefix}${n-1}.jpg`},
        {label:"This photo", url:`https://res.cloudinary.com/dvqpndvej/image/upload/${parsed.folder}/${prefix}${n}.jpg`},
        {label:"Next", url:`https://res.cloudinary.com/dvqpndvej/image/upload/${parsed.folder}/${prefix}${n+1}.jpg`}
      ];

      const checks = await Promise.all(targets.map(t => imgOk(t.url)));
      const found = checks.map((c,i)=>({...targets[i], ok:c.ok})).filter(x=>x.ok);

      if (!found.length){ msg.textContent = "No images found for that range."; return; }

      msg.textContent = "Done.";
      found.forEach(x => addCard(x.url, x.label));
    }

    $("#go").onclick = run;
    $("#urlInput").addEventListener("keydown", e => { if (e.key === "Enter") run(); });
  </script>
</body>
</html>
