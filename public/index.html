<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Find your photos</title>
  <style>
    :root { color-scheme: dark; }
    body{margin:0;background:#0b1220;color:#cbd5e1;font:16px system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif}
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    h1{font-size:28px;margin:0 0 12px}
    .card{background:#0f172a;border:1px solid #1e293b;border-radius:14px;padding:14px}
    .row{display:flex;flex-wrap:wrap;gap:14px;margin-top:16px}
    .imgcard{width:340px;background:#0f172a;border:1px solid #1e293b;border-radius:12px;overflow:hidden}
    .imgcard img{display:block;width:100%;height:auto}
    .imgcard .cap{padding:8px 10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:14px;color:#93a3b8}
    input[type="text"]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #334155;background:#0b1220;color:#e2e8f0}
    .row-ctl{display:flex;gap:10px;align-items:center}
    button{padding:10px 14px;border-radius:8px;border:1px solid #10b981;background:#10b981;color:#04121a;font-weight:600;cursor:pointer}
    #msg{margin-top:8px;color:#93a3b8;font-size:14px;min-height:20px}
    small a{color:#a5b4fc}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Find your photos</h1>
    <div class="card">
      <p>Paste a Cloudinary image URL <em>or</em> a public_id path and click Load.</p>
      <p style="margin-top:-6px"><small>Example URL:<br>
        https://res.cloudinary.com/dvqpndvej/image/upload/chiefs-luau/2025/September/09.28.2025/CH0928251006.jpg</small></p>
      <div class="row-ctl">
        <input id="inp" type="text" placeholder="Full URL or public_id path (folder/.../CH##########)" />
        <button id="go">Load</button>
      </div>
      <div id="msg"></div>
    </div>

    <div class="row" id="row"></div>
  </div>

  <script>
    const CLOUD = "dvqpndvej"; // your cloud (already correct)

    const row = document.getElementById("row");
    const msg = document.getElementById("msg");
    const inp = document.getElementById("inp");
    document.getElementById("go").onclick = handle;

    function toPublicId(input){
      const s = (input||"").trim();
      if (!s) return null;

      // If it's a full delivery URL, extract the public_id (path without extension)
      if (/res\.cloudinary\.com/.test(s)){
        const m = s.match(/\/image\/upload\/(?:v\d+\/)?(.+?)\.(?:jpe?g|png|webp|gif)$/i);
        return m ? m[1] : null;
      }
      // If it looks like a bare public_id (folder/.../CH###########), accept as-is
      return s.replace(/\.(?:jpe?g|png|webp|gif)$/i, "");
    }

    function neighbors(file){
      const digits = (file.match(/(\d+)$/)||[])[1] || "";
      const prefix = file.slice(0, file.length - digits.length);
      const n = parseInt(digits||"0", 10);
      return [ `${prefix}${n-1}`, `${prefix}${n}`, `${prefix}${n+1}` ];
    }

    function urlFrom(pubId){ return `https://res.cloudinary.com/${CLOUD}/image/upload/${pubId}.jpg`; }

    function loadImg(url){
      return new Promise(res=>{
        const im = new Image();
        im.onload = () => res({ok:true, url});
        im.onerror = () => res({ok:false, url});
        im.src = url;
      });
    }

    function addCard(url, label){
      const card = document.createElement("div");
      card.className = "imgcard";
      card.innerHTML = `<img src="${url}" alt="">
        <div class="cap">${label || url.replace(/^https?:\/\/[^/]+\/image\/upload\//,'')}</div>`;
      row.appendChild(card);
    }

    async function handle(){
      row.innerHTML = "";
      msg.textContent = "Checkingâ€¦";

      const pub = toPublicId(inp.value);
      if (!pub){ msg.textContent = "Please paste a valid Cloudinary URL or path."; return; }

      // Split into folder + filename
      const file = pub.split("/").pop();
      const folder = pub.replace(/\/[^/]+$/, ""); // drop filename

      // Build three candidate URLs from the SAME folder
      const [prev, cur, next] = neighbors(file);
      const candidates = [
        {label:"Previous", url: urlFrom(`${folder}/${prev}`)},
        {label:"This photo", url: urlFrom(`${folder}/${cur}`)},
        {label:"Next",     url: urlFrom(`${folder}/${next}`)}
      ];

      const checks = await Promise.all(candidates.map(c => loadImg(c.url)));
      const found = checks
        .map((r,i)=>({...r, label:candidates[i].label}))
        .filter(r => r.ok);

      if (!found.length){
        msg.textContent = "None of the three images loaded. Double-check the folder and number.";
        return;
      }

      found.forEach(r => addCard(r.url, r.label));
      msg.textContent = "Done.";
    }
  </script>
</body>
</html>
