<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Find Neighbor Photos</title>
<style>
  :root{--bg:#0d1117;--panel:#161b22;--border:#30363d;--text:#e6edf3;--muted:#9aa3ad;--brand:#9dd6ff;--ok:#238636}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:980px;margin:48px auto;padding:0 20px}
  h1{margin:0 0 8px;color:var(--brand);font-size:28px}
  .hint{color:var(--muted);margin:0 0 18px}
  .bar{display:flex;gap:8px}
  input{flex:1;min-width:320px;background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px 12px}
  button{background:var(--ok);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  #msg{margin-top:10px;color:var(--muted)}
  #row{display:flex;flex-wrap:wrap;gap:16px;margin-top:22px}
  .card{width:320px;background:var(--panel);border:1px solid var(--border);border-radius:12px;overflow:hidden}
  .card img{display:block;width:100%;height:auto}
  .label{padding:8px 10px;color:var(--brand);font-weight:600}
  .url{padding:0 10px 10px;color:#8fa3b0;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Find Neighbor Photos</h1>
    <p class="hint">Paste a full Cloudinary URL (the same one that opens in your browser) and click Load.</p>
    <p class="hint" style="font-size:13px">
      Example: https://res.cloudinary.com/dvqpndvej/image/upload/chiefs-luau/2025/September/09.28.2025/CH0928251006.jpg
    </p>
    <div class="bar">
      <input id="urlInput" placeholder="Paste Cloudinary URL ending in .jpg or .jpeg" />
      <button id="go">Load</button>
    </div>
    <div id="msg"></div>
    <div id="row"></div>
  </div>

<script>
const $ = s => document.querySelector(s);
const row = $("#row"), msg = $("#msg");

function imgOk(url){
  return new Promise(res => {
    const img = new Image();
    img.onload  = () => res({ok:true, url});
    img.onerror = () => res({ok:false, url});
    img.src = url;
  });
}

// Accepts WITH or WITHOUT version segment (v1759…), .jpg/.jpeg, any cloud name.
function parseCloudinaryUrl(u){
  // https://res.cloudinary.com/<cloud>/image/upload/(v123/)?<folder>/<file>.(jpg|jpeg)
  const re = /^https?:\/\/res\.cloudinary\.com\/([^/]+)\/image\/upload\/(?:v\d+\/)?(.+?)\/([^/]+?)\.(jpe?g)$/i;
  const m = u.trim().match(re);
  if(!m) return null;
  return { cloud:m[1], folder:m[2], file:m[3], ext:m[4].toLowerCase() };
}

function buildUrl({cloud, folder, file, ext}) {
  return `https://res.cloudinary.com/${cloud}/image/upload/${folder}/${file}.${ext}`;
}

function suffixNumber(name){
  const m = name.match(/(\d+)$/);
  if(!m) return null;
  const digits = m[1];
  const n = parseInt(digits, 10);
  const prefix = name.slice(0, name.length - digits.length);
  return {prefix, n};
}

function addCard(url, label){
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `
    <img src="${url}" alt="${label}">
    <div class="label">${label}</div>
    <div class="url">${url.replace(/^https?:\/\/[^/]+\/image\/upload\//,'')}</div>
  `;
  row.appendChild(card);
}

async function run(){
  row.innerHTML = "";
  msg.textContent = "Loading…";

  const input = $("#urlInput").value.trim();
  const parsed = parseCloudinaryUrl(input);
  if(!parsed){ msg.textContent = "Please paste the full Cloudinary URL that ends in .jpg or .jpeg."; return; }

  const suf = suffixNumber(parsed.file);
  if(!suf){ msg.textContent = "The filename doesn’t end in a number (e.g., …1006)."; return; }

  // Build prev / cur / next using SAME cloud, folder, and extension as pasted URL.
  const prev = buildUrl({ cloud: parsed.cloud, folder: parsed.folder, file: `${suf.prefix}${suf.n-1}`, ext: parsed.ext });
  const cur  = buildUrl({ cloud: parsed.cloud, folder: parsed.folder, file: `${suf.prefix}${suf.n}`,   ext: parsed.ext });
  const next = buildUrl({ cloud: parsed.cloud, folder: parsed.folder, file: `${suf.prefix}${suf.n+1}`, ext: parsed.ext });

  const targets = [
    {label:"Previous", url: prev},
    {label:"This photo", url: cur},
    {label:"Next", url: next},
  ];

  const checks = await Promise.all(targets.map(t => imgOk(t.url)));
  const found = checks.map((c,i)=>({ ...targets[i], ok:c.ok })).filter(x => x.ok);

  if(!found.length){
    msg.textContent = "No images found for that range. Double-check folder + number (…1005/1006/1007).";
    return;
  }

  msg.textContent = "Done.";
  found.forEach(x => addCard(x.url, x.label));
}

$("#go").onclick = run;
$("#urlInput").addEventListener("keydown", e => { if(e.key === "Enter") run(); });
</script>
</body>
</html>
