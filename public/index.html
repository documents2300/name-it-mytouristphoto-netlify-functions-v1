<script>
  const CLOUD = "dvqpndvej"; // your Cloudinary cloud name
  const row = document.getElementById("row");
  const msg = document.getElementById("msg");

  function deliveryUrl(pubId) {
    return `https://res.cloudinary.com/${CLOUD}/image/upload/${pubId}.jpg`;
  }

  function plusMinusOne(id) {
    const digits = (id.match(/(\d+)$/) || [])[1] || "";
    const prefix = id.slice(0, id.length - digits.length);
    const n = parseInt(digits || "0", 10);
    return [`${prefix}${n - 1}`, id, `${prefix}${n + 1}`];
  }

  async function loadImg(url) {
    return new Promise((resolve) => {
      const img = new Image();
      img.onload = () => resolve({ ok: true, url });
      img.onerror = () => resolve({ ok: false, url });
      img.src = url;
    });
  }

  function addCard(url) {
    const card = document.createElement("div");
    card.style.width = "320px";
    card.style.border = "1px solid #ddd";
    card.style.borderRadius = "8px";
    card.style.overflow = "hidden";
    card.innerHTML = `
      <img src="${url}" style="display:block;width:100%;height:auto" />
      <div style="padding:6px 8px;font:14px system-ui, sans-serif;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
        ${url.replace(/^https?:\/\/[^/]+\/image\/upload\//,'')}
      </div>`;
    row.appendChild(card);
  }

  document.getElementById("goBtn").onclick = async () => {
    row.innerHTML = "";
    msg.textContent = "Checkingâ€¦";

    const input = document.getElementById("inp").value.trim();
    if (!input) return;

    // Split folder + filename
    const folder = input.replace(/\/[^/]+$/, "");
    const file = input.split("/").pop();
    const [prev, cur, next] = plusMinusOne(file);

    // Build neighbors in SAME folder
    const candidates = [
      `${folder}/${prev}`,
      `${folder}/${cur}`,
      `${folder}/${next}`,
    ];

    const checks = await Promise.all(candidates.map(p => loadImg(deliveryUrl(p))));
    const found = checks.filter(c => c.ok);

    msg.textContent = found.length ? "" : "None of the 3 images existed.";
    found.forEach(c => addCard(c.url));
  };
</script>
