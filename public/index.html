<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find Neighbor Photos</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background-color: #0d1117;
      color: #e6edf3;
      margin: 0;
      padding: 40px;
      text-align: center;
    }
    h1 {
      color: #9dd6ff;
      margin-bottom: 20px;
    }
    input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #30363d;
      background: #161b22;
      color: #e6edf3;
      width: 70%;
      max-width: 600px;
    }
    button {
      padding: 10px 14px;
      border-radius: 8px;
      background: #238636;
      color: white;
      border: none;
      margin-left: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    #msg {
      margin-top: 15px;
      font-size: 14px;
      color: #9aa3ad;
    }
    #row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      margin-top: 30px;
    }
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 10px;
      width: 320px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .card img {
      display: block;
      width: 100%;
      height: auto;
    }
    .card .label {
      padding: 8px 10px;
      font-weight: 600;
      color: #9dd6ff;
      text-align: left;
    }
    .card .url {
      padding: 0 10px 10px;
      color: #8fa3b0;
      font-size: 13px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: left;
    }
  </style>
</head>
<body>

  <h1>Find neighbor photos</h1>
  <p>Paste a Cloudinary URL or just the short ID (e.g., <b>CH0928251006</b>) and click Load.</p>
  <input id="urlInput" placeholder="Full Cloudinary URL or CH0928251006" />
  <button id="go">Load</button>
  <div id="msg"></div>
  <div id="row"></div>

  <script>
    // --- CONFIG ---
    const CLOUD = "dvqpndvej";
    const BASE_FOLDER = "chiefs-luau/2025/September/09.28.2025"; // fixed folder

    // --- helpers ---
    const $ = s => document.querySelector(s);
    function imgOk(url){ return new Promise(r => {
      const i = new Image();
      i.onload = () => r({ok:true, url});
      i.onerror = () => r({ok:false, url});
      i.src = url;
    });}
    function urlFor(folder, file){ return `https://res.cloudinary.com/${CLOUD}/image/upload/${folder}/${file}.jpg`; }
    function neighbors(file){
      const m = (file.match(/(\d+)$/)||[])[1]||"";
      const prefix = file.slice(0, file.length - m.length);
      const n = parseInt(m||"0",10);
      return [
        {label:"Previous", file:`${prefix}${n-1}`},
        {label:"This photo", file:`${prefix}${n}`},
        {label:"Next", file:`${prefix}${n+1}`}
      ];
    }
    function addCard(url,label){
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${url}" alt="${label}" />
        <div class="label">${label}</div>
        <div class="url">${url.replace(/^https?:\/\/[^/]+\/image\/upload\//,'')}</div>
      `;
      $("#row").appendChild(card);
    }

    // Parse either a full Cloudinary URL or short ID
    function parseInput(v){
      const raw = (v||"").trim();
      if (!raw) return null;
      const m = raw.match(/^https?:\/\/res\.cloudinary\.com\/[^/]+\/image\/upload\/(?:v\d+\/)?(.+?)\.(?:jpe?g|png|webp)$/i);
      if (m){
        const path = m[1];
        return { folder: path.replace(/\/[^/]+$/,""), file: path.split("/").pop() };
      }
      return { folder: BASE_FOLDER, file: raw.toUpperCase() };
    }

    async function run(){
      const input = $("#urlInput");
      const msg = $("#msg");
      const row = $("#row");
      row.innerHTML = "";
      msg.textContent = "Loading...";

      const parsed = parseInput(input.value);
      if (!parsed){ msg.textContent = "Please enter a URL or short ID."; return; }

      const urls = neighbors(parsed.file).map(x => ({label:x.label, url:urlFor(parsed.folder, x.file)}));
      const checks = await Promise.all(urls.map(x => imgOk(x.url)));
      const found = checks.map((c,i)=>({...urls[i], ok:c.ok})).filter(x=>x.ok);

      if (!found.length){ msg.textContent = "None of the 3 images loaded. Double-check the ID (CH... uppercase) and folder."; return; }

      msg.textContent = "Done.";
      found.forEach(x => addCard(x.url, x.label));
    }

    $("#go").onclick = run;
    $("#urlInput").addEventListener("keydown", e => { if (e.key === "Enter") run(); });
  </script>
</body>
</html>
